---
title: v0.1.0 Trading Pipeline 测试报告
version: v0.1.0
module: trading-pipeline
author: 全员
date: 2026-02-27
status: passed
type: test-report
---

# v0.1.0 Trading Pipeline 测试报告

### 测试概况

| 指标     | v0.1.0 基线 (02-27) | v0.1.0+ (02-28)         |
| -------- | ------------------- | ----------------------- |
| 测试套件 | 32                  | 51（46 unit + 5 live）  |
| 测试用例 | 322                 | ~508                    |
| 通过率   | 100% (322/322)      | 100%（fin-\* 全部通过） |
| 覆盖率   | 待补充              | 待补充                  |
| 测试框架 | Vitest ^3.1         | Vitest ^3.1             |
| 执行环境 | Node.js v22.22.0    | Node.js v22.22.0        |
| 执行耗时 | 2.57s               | ~3.5s                   |

### 模块测试状态（v0.1.0 基线 — 2026-02-27）

| 模块                                   | 套件数 | 用例数 | 通过 | 失败 | 跳过 | 备注                                        |
| -------------------------------------- | ------ | ------ | ---- | ---- | ---- | ------------------------------------------- |
| fin-paper-trading/paper-account        | 1      | 10     | 10   | 0    | 0    | 账户状态、买卖、余额不足拒绝                |
| fin-paper-trading/paper-engine         | 1      | 19     | 19   | 0    | 0    | 下单、快照、持久化、getSnapshots/getOrders  |
| fin-paper-trading/paper-store          | 1      | 12     | 12   | 0    | 0    | SQLite CRUD、快照存取                       |
| fin-paper-trading/fill-simulation      | 2      | 12     | 12   | 0    | 0    | 手续费模型 + 恒定滑点模型                   |
| fin-paper-trading/market-calendar      | 1      | 9      | 9    | 0    | 0    | 多市场开市判断、交易对归属                  |
| fin-strategy-engine/backtest           | 1      | 14     | 14   | 0    | 0    | 回测核心、手续费、滑点                      |
| fin-strategy-engine/walk-forward       | 1      | 7      | 7    | 0    | 0    | 窗口划分、IS/OOS、通过判定                  |
| fin-strategy-engine/sma-crossover      | 1      | 4      | 4    | 0    | 0    | 金叉/死叉信号、预热期                       |
| fin-strategy-engine/rsi-mean-reversion | 1      | 5      | 5    | 0    | 0    | 超买超卖信号、重复买入防护                  |
| fin-strategy-engine/indicators         | 1      | 20     | 20   | 0    | 0    | SMA/EMA/RSI/MACD/BB/ATR                     |
| fin-strategy-engine/fitness            | 1      | 8      | 8    | 0    | 0    | 时间衰减适应度、相关性惩罚                  |
| fin-strategy-engine/strategy-registry  | 1      | 14     | 14   | 0    | 0    | CRUD、等级过滤、JSON 持久化                 |
| fin-fund-manager/fund-manager          | 1      | 30     | 30   | 0    | 0    | 基金核心、分配、晋级、降级                  |
| fin-fund-manager/capital-allocator     | 1      | 12     | 12   | 0    | 0    | 资金分配、单策略上限、相关性约束            |
| fin-fund-manager/promotion-pipeline    | 1      | 19     | 19   | 0    | 0    | L0→L1→L2→L3 晋级 + L3→L2→L1 降级            |
| fin-fund-manager/leaderboard           | 1      | 5      | 5    | 0    | 0    | 排名、L0 过滤、WF 加分                      |
| fin-fund-manager/fund-risk-manager     | 1      | 11     | 11   | 0    | 0    | 日回撤等级、缩放因子                        |
| fin-fund-manager/correlation-monitor   | 1      | 7      | 7    | 0    | 0    | Pearson 相关系数、配对检测                  |
| fin-data-bus/regime-detector           | 1      | 8      | 8    | 0    | 0    | 牛/熊/危机/震荡/横盘检测                    |
| fin-trading/ccxt-bridge                | 1      | 13     | 13   | 0    | 0    | 下单、余额、订单簿                          |
| fin-core/index                         | 1      | 22     | 22   | 0    | 0    | ExchangeRegistry、RiskController、HTTP 路由 |
| **其他 fin-\* 测试**                   | 10     | ~60    | ~60  | 0    | 0    | expert-sdk、info-feed、monitoring 等        |

### v0.1.0+ 增量更新（2026-02-28）

> 以下为 commit `7b1a3c490`（v0.1.0 基线）之后新增/变更的 Pipeline 相关测试。

#### 新增 Commit 清单

| Commit     | 类型 | 描述                                                            |
| ---------- | ---- | --------------------------------------------------------------- |
| `21f7c159` | feat | Bollinger Bands + MACD Divergence 内置策略                      |
| `6ad2e1ef` | feat | Trading Dashboard SSE 推送 + 增量 DOM 更新                      |
| `71ec9aeb` | feat | fin-monitoring, fin-expert-sdk, fin-info-feed, fin-trading 增强 |
| `f38b3237` | fix  | 修复 bluebubbles 和 fin-market-data TypeScript 错误             |
| `e1d32e2e` | test | fin-\* 单元测试批量新增 + configure command 测试                |
| `4132e05a` | feat | Finance Config Dashboard, env example, 工具链                   |
| `ea1894c4` | fix  | Trading Dashboard 数据注入修复 + SSE 集成测试                   |

#### 新增/扩展模块测试

| 模块                                | 套件数 | 用例数 | 通过 | 备注                                    |
| ----------------------------------- | ------ | ------ | ---- | --------------------------------------- |
| fin-strategy-engine/bollinger-bands | 1      | 4      | 4    | 布林带突破策略：上轨/下轨/中轨信号      |
| fin-strategy-engine/macd-divergence | 1      | 4      | 4    | MACD 背离策略：牛/熊背离、直方图翻转    |
| fin-strategy-engine/stats           | 1      | 34     | 34   | 收益统计、回撤计算、VaR                 |
| fin-strategy-engine/index           | 1      | 13     | 13   | 策略注册、参数校验                      |
| fin-strategy-memory/index           | 1      | 13     | 13   | 记忆服务初始化、持久化                  |
| fin-strategy-memory/success-book    | 1      | 11     | 11   | 成功交易模式识别、回放逻辑              |
| fin-strategy-memory/error-book      | 1      | 11     | 11   | 亏损追踪、错误模式识别                  |
| fin-strategy-memory/hooks           | 1      | 17     | 17   | 策略生命周期 Hooks 集成                 |
| fin-strategy-memory/trade-journal   | 1      | 12     | 12   | 交易日志记录、指标计算                  |
| fin-strategy-memory/experience-sync | 1      | 11     | 11   | 跨策略经验共享                          |
| fin-core/index（SSE 扩展）          | —      | +3     | +3   | SSE streaming 集成测试                  |
| fin-core/exchange-registry          | 1      | 10     | 10   | 交易所配置管理、CCXT 实例               |
| fin-data-bus/crypto-adapter         | 1      | 9      | 9    | OHLCV 获取、CCXT 缓存、Ticker           |
| fin-data-bus/ohlcv-cache            | 1      | 10     | 10   | SQLite OHLCV 缓存 + 时间框架隔离        |
| fin-data-bus/index                  | 1      | 10     | 10   | Tool 注册、数据管线                     |
| fin-paper-trading/index             | 1      | 16     | 16   | 插件元数据、tool/service 注册、集成测试 |
| fin-paper-trading/decay-detector    | 1      | 8      | 8    | 健康指标、连续亏损日、回撤追踪          |
| fin-fund-manager/index              | 1      | 2      | 2    | 路由注册、Dashboard 渲染                |
| fin-fund-manager/formatters         | 1      | 10     | 10   | 状态/风控/排名/分配格式化               |
| fin-expert-sdk/index                | 1      | 4      | 4    | Stub/live mode, remote backend          |
| fin-info-feed/index                 | 1      | 4      | 4    | 新闻推送 tool, stub/live                |
| fin-monitoring/index                | 1      | 5      | 5    | 告警生命周期、定时检查                  |
| fin-trading/index                   | 1      | 7      | 7    | Trading tool 注册                       |
| fin-trading/ccxt-bridge（扩展）     | —      | +2     | +2   | 新增多交易所路由测试                    |
| fin-portfolio/index                 | 1      | 14     | 14   | 组合构成、资产分配、绩效                |

#### 更新后汇总

| 指标        | v0.1.0 基线 (02-27) | v0.1.0+ (02-28)        | 变化           |
| ----------- | ------------------- | ---------------------- | -------------- |
| 测试套件    | 32                  | 51（46 unit + 5 live） | +19            |
| 测试用例    | 322                 | ~508                   | +186           |
| fin-\* 模块 | 6（核心管线）       | 12（全覆盖）           | +6 新模块      |
| 全量回归    | 13,708 / 0 failed   | 13,731 / 1 failed\*    | +23 / +1 known |

\* 全量回归中 1 个失败为 `src/pi-embedded-runner.test.ts`（core 模块，非 fin-\*），2 个 skipped。

### 集成测试 & E2E 验证记录

| #   | 场景                       | 执行方式                                                 | 结果 | 备注                                                  |
| --- | -------------------------- | -------------------------------------------------------- | ---- | ----------------------------------------------------- |
| 1   | 模拟盘全链路 (Paper)       | `npx tsx scripts/finance/run-trading-pipeline.ts`        | PASS | 5.8s，合成数据，8 步全部完成                          |
| 2   | 真实 Testnet 全链路 (Live) | `npx tsx scripts/finance/run-trading-pipeline.ts --live` | PASS | 3.7s，Binance Testnet BUY+SELL BTC/USDT @ $67,952     |
| 3   | Gateway Trading API        | `curl http://localhost:18789/api/v1/finance/trading`     | PASS | HTTP 200，JSON 含 summary/positions/orders/strategies |
| 4   | Gateway Trading Dashboard  | `curl http://localhost:18789/dashboard/trading`          | PASS | HTTP 200，~34KB HTML，7 面板全部渲染                  |
| 5   | Gateway Finance Config API | `curl http://localhost:18789/api/v1/finance/config`      | PASS | HTTP 200，exchanges/trading/plugins 数据正确          |
| 6   | Gateway Finance Dashboard  | `curl http://localhost:18789/dashboard/finance`          | PASS | HTTP 200，HTML 渲染正常                               |
| 7   | 数据持久化验证             | Pipeline Step 8 自动验证                                 | PASS | SQLite reload 成功，2 accounts，6 orders，2 snapshots |
| 8   | 全量回归测试               | `pnpm test` (全仓库)                                     | PASS | 13,708 tests，1,621 files，0 failures                 |

### 变更文件清单

| 文件                                                   | 变更类型 | 行数 | 说明                                 |
| ------------------------------------------------------ | -------- | ---- | ------------------------------------ |
| `extensions/fin-paper-trading/src/paper-engine.ts`     | 修改     | +12  | 添加 getSnapshots/getOrders 公共方法 |
| `extensions/fin-core/dashboard/trading-dashboard.css`  | 新建     | ~330 | Bloomberg Terminal 级深色主题        |
| `extensions/fin-core/dashboard/trading-dashboard.html` | 新建     | ~370 | 7 面板 Dashboard，安全 DOM 构造      |
| `extensions/fin-core/index.ts`                         | 修改     | +150 | 数据聚合 + API/HTML 路由注册         |
| `scripts/finance/run-trading-pipeline.ts`              | 新建     | ~413 | 独立 8 步全链路脚本                  |
| `extensions/fin-fund-manager/index.ts`                 | 修改     | +55  | `fund pipeline` CLI 子命令           |

### 已知问题

| #   | 模块                 | 描述                                                                  | 严重级别 | 状态      |
| --- | -------------------- | --------------------------------------------------------------------- | -------- | --------- |
| 1   | trading-dashboard    | 服务未运行时 Dashboard 显示空数据（设计如此，optional chaining 降级） | Minor    | accepted  |
| 2   | run-trading-pipeline | 离线时使用合成数据，回测结果仅供演示                                  | Minor    | accepted  |
| 3   | fund pipeline CLI    | Live 模式引导用户使用独立脚本，未直接集成 CcxtBridge                  | Minor    | by-design |

### 测试执行记录

```
执行时间: 2026-02-27 19:42:43
执行命令: pnpm test -- --reporter=verbose extensions/fin-*

 Test Files  32 passed (32)
      Tests  322 passed (322)
   Start at  19:42:43
   Duration  2.57s (transform 510ms, setup 1.02s, import 653ms, tests 1.42s, environment 2ms)
```

### 全量回归

```
执行时间: 2026-02-27 (同日早间)
执行命令: pnpm test

 Test Files  1621 passed (1621)
      Tests  13708 passed (13708)
   Duration  ~45s
```

### 全量回归（v0.1.0+ 更新 2026-02-28）

```
执行时间: 2026-02-28
执行命令: pnpm test

 Test Files  13731 passed | 1 failed | 2 skipped (13734)
    Failed:  src/pi-embedded-runner.test.ts (core, non fin-*)
   Duration  ~50s
```
