---
title: Trading Pipeline 全链路交易验收标准
version: v0.1.0
module: trading-pipeline
author: 全员
date: 2026-02-27
status: passed
---

# Trading Pipeline 全链路交易验收标准

## 功能验收

### 1. 独立全链路脚本 (`scripts/finance/run-trading-pipeline.ts`)

- [x] 8 步流程完整执行：Init → OHLCV → Strategy → Backtest → Walk-Forward → Paper → Live(optional) → Summary
- [x] `bun scripts/finance/run-trading-pipeline.ts` 模拟盘全链路正常运行
- [x] `bun scripts/finance/run-trading-pipeline.ts --live` 含真实 Binance Testnet 下单
- [x] 离线/无网环境自动降级到合成数据（synthetic OHLCV）
- [x] 支持 3 个交易对同时运行：BTC/USDT, ETH/USDT, SOL/USDT
- [x] SMA Crossover 策略创建 × 3，参数 SMA(5,20)
- [x] 回测引擎：含手续费（0.1%）和滑点（5 bps）
- [x] Walk-Forward 验证：3 窗口，threshold 0.3
- [x] 模拟盘：$100K 初始资金，3 对市价买入，快照记录
- [x] Live Testnet：CcxtBridge 市价买入 + 立即卖出 BTC/USDT（已验证 @ $67,952）
- [x] 汇总输出：收益率、Sharpe、交易次数、最终权益表格

### 2. Gateway CLI 命令 (`openfinclaw fund pipeline`)

- [x] `fund pipeline` 子命令注册在 fin-fund-manager 插件
- [x] 支持 `--live` 参数
- [x] 查询 `fin-strategy-registry`、`fin-paper-engine` 等服务状态
- [x] 列出策略、账户、配置、风控评估信息

### 3. Trading Dashboard UI (`/dashboard/trading`)

- [x] 7 面板完整渲染：Hero、Equity Curve、Allocation、Positions、Strategy Cards、Orders、Backtest
- [x] `GET /api/v1/finance/trading` JSON API 返回 HTTP 200
- [x] `GET /dashboard/trading` HTML 渲染返回 HTTP 200（~34KB）
- [x] Hero 面板：总权益、日 P&L、活跃策略数、持仓数
- [x] Equity Curve：Chart.js 折线图（权益随时间变化）
- [x] Allocation：Chart.js 甜甜圈图（资金分配）
- [x] Positions 表格：币对、方向、数量、入场价、现价、未实现 P&L
- [x] Strategy Cards：等级徽章、收益率、Sharpe、MaxDD、Trades
- [x] Orders 表格：时间、币对、方向、价格、状态
- [x] Backtest 对比表：策略 × 核心指标矩阵

### 4. 数据持久化

- [x] SQLite 持久化：模拟盘账户、订单、持仓、权益快照
- [x] JSON 持久化：策略注册表
- [x] SQLite 持久化：OHLCV 缓存
- [x] 重启后数据可重新加载验证
- [x] 存储路径：`~/.openfinclaw/state/` (pipeline-paper.sqlite, pipeline-ohlcv.sqlite, pipeline-strategies.json)

### 5. PaperEngine 接口扩展

- [x] `getSnapshots(accountId)` 公共方法（权益曲线数据源）
- [x] `getOrders(accountId, limit?)` 公共方法（订单流水数据源）

## 安全验收

- [x] Dashboard HTML 使用安全 DOM 构造（NO innerHTML），遵循 commit `4706f23fe` 模式
- [x] JSON 数据注入使用 `<\/` 转义防 XSS
- [x] API Key / Secret 不在日志中明文输出
- [x] Live 模式需显式 `--live` 参数 + 环境变量双重确认
- [x] 服务查询全部使用 optional chaining（缺失时降级为空数据）
- [x] Risk Controller hook 拦截所有 `fin_place_order` / `fin_modify_order` 调用

## UI 验收

- [x] Bloomberg Terminal 级深色主题（`--fc-bg: #0a0e14`）
- [x] 响应式布局：12 列 CSS Grid，移动端自适应
- [x] P&L 正负色系：绿色正 / 红色负
- [x] 策略等级徽章：L3 绿 / L2 蓝 / L1 黄 / L0 灰
- [x] 订单状态徽章：filled 绿 / pending 蓝 / rejected 红
- [x] 持仓行颜色区分：long 绿 / short 红
- [x] Chart.js 图表风格统一：暗色背景 + 蓝色折线 + 紫色甜甜圈
- [x] 10 秒自动刷新，Live 脉冲动画
- [x] 终端输出美观：ANSI 彩色 + 步骤分隔 + 表格对齐

## 性能验收

- [x] 模拟盘全链路 < 10s 完成（实测 5.8s）
- [x] Live Testnet 全链路 < 10s 完成（实测 3.7s）
- [x] Dashboard HTML 响应 < 500ms
- [x] JSON API 响应 < 100ms
- [x] 322 个 fin-\* 单元测试总时间 < 3s（实测 2.57s）

## 测试验收

- [x] fin-paper-trading 测试：PaperAccount、PaperEngine、PaperStore、FillSimulation（滑点 + 手续费）、MarketCalendar
- [x] fin-strategy-engine 测试：BacktestEngine、WalkForward、SMA Crossover、RSI Mean Reversion、Indicators（SMA/EMA/RSI/MACD/BB/ATR）、Fitness、StrategyRegistry
- [x] fin-fund-manager 测试：FundManager、CapitalAllocator、PromotionPipeline、Leaderboard、FundRiskManager、CorrelationMonitor
- [x] fin-data-bus 测试：RegimeDetector
- [x] fin-trading 测试：CcxtBridge
- [x] fin-core 测试：ExchangeRegistry、RiskController
- [x] 32 个测试文件，322 个测试用例，100% 通过率
- [x] 全量回归：13,708 个测试用例，0 失败

## v0.1.0+ 增量验收（2026-02-28）

### 6. SSE 实时推送

- [x] Trading Dashboard 从 HTTP polling 升级为 SSE（Server-Sent Events）推送
- [x] SSE 端点 `/api/v1/finance/trading/stream` 返回 `text/event-stream`
- [x] 增量 DOM 更新：仅刷新变化的面板，无全页重载
- [x] SSE 连接断开后自动重连（客户端 EventSource fallback）
- [x] SSE 集成测试覆盖：连接建立、数据推送、断开重连

### 7. Bollinger Bands 策略

- [x] 布林带突破策略实现（`builtin-strategies/bollinger-bands.ts`）
- [x] 上轨突破做空、下轨突破做多、中轨信号
- [x] 参数可配置：周期（默认 20）、标准差倍数（默认 2）
- [x] 单元测试 4 用例，100% 通过

### 8. MACD Divergence 策略

- [x] MACD 背离策略实现（`builtin-strategies/macd-divergence.ts`）
- [x] 牛市背离（价格新低 + MACD 不创新低）做多信号
- [x] 熊市背离（价格新高 + MACD 不创新高）做空信号
- [x] 直方图翻转确认
- [x] 单元测试 4 用例，100% 通过

### 9. Control UI 侧边栏 + Finance Config Dashboard

- [x] Finance Config Dashboard 路由 `/dashboard/finance` 注册
- [x] Finance Config API `/api/v1/finance/config` 返回 exchanges/trading/plugins 数据
- [x] `.env.example` 包含完整的金融配置环境变量模板
- [x] Dashboard HTML 渲染正常，HTTP 200

### 10. 策略记忆系统（fin-strategy-memory）

- [x] 成功簿（Success Book）：成功交易模式识别与回放
- [x] 错误簿（Error Book）：亏损追踪与错误模式识别
- [x] 交易日志（Trade Journal）：完整交易记录与指标计算
- [x] 策略生命周期 Hooks：自动记录策略事件
- [x] 经验同步（Experience Sync）：跨策略经验共享
- [x] 6 个测试套件，75 个测试用例，100% 通过

### 11. fin-\* 扩展增强

- [x] fin-expert-sdk：stub/live mode 切换，远程后端集成
- [x] fin-info-feed：新闻推送 tool 注册，stub/live mode
- [x] fin-monitoring：告警生命周期管理，定时检查调度
- [x] fin-trading：多交易所路由增强，tool 注册完善
- [x] fin-portfolio：组合构成、资产分配、绩效指标
- [x] fin-data-bus：crypto-adapter + OHLCV cache + 数据管线 tool 注册

### 12. 测试覆盖更新

- [x] fin-\* 测试套件从 32 扩展到 51（46 unit + 5 live）
- [x] fin-\* 测试用例从 322 扩展到 ~508
- [x] 覆盖模块从 6 个核心管线扩展到 12 个全部 fin-\* 扩展
- [x] 全量回归：13,731 passed / 1 failed（core pi-embedded-runner，非 fin-\*）/ 2 skipped
