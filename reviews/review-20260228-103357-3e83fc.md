# Consolidated Review: 2026-02-28 10:33:57

## Agents Run

- Agent 1 (Diff Review): `019ca21c-3601-70f1-beaa-71cab36178be`
- Agent 2 (Holistic Review): `019ca21c-361d-7641-bb7e-b87be4a69da3`

## Deduplication

- No exact duplicate findings across agents.
- Findings below are normalized and ordered by severity.

## Critical

1. **File/Directory:** `package.json`, `README.md`, `docs/**`, `AGENTS.md`
   **Line:** N/A (structural)
   **Severity:** critical
   **Category:** Holistic
   **Description:** CLI command surface is inconsistent (`openfinclaw` in `bin`, `finclaw` in README examples, and `openclaw` across docs/agent guidance), creating conflicting operator/agent entrypoints.
   **Suggested fix:** Pick one canonical CLI name, align README/docs/AGENTS to it, and keep explicit compatibility aliases with deprecation messaging if legacy names must remain.

## High

1. **File/Directory:** `AGENTS.md`
   **Line:** N/A (structural)
   **Severity:** high
   **Category:** Holistic
   **Description:** Agent instructions reference paths/commands not present in the current repo state (for example `src/provider-web.ts`, `docs/testing.md`, and `pnpm openclaw ...` without a matching script).
   **Suggested fix:** Update `AGENTS.md` to current paths/scripts and add CI validation for referenced files/commands.

2. **File/Directory:** `extensions/fin-core/index.ts`
   **Line:** 196
   **Severity:** high
   **Category:** Diff
   **Description:** Finance dashboard placeholder replacement uses `/*__FINANCE_DATA__*/{}` but template token is `/*__FINANCE_DATA__*/ {}`. Replacement can fail, leaving `{}` and causing first-render dereference failures (for example `financeData.exchanges.length`).
   **Suggested fix:** Match exact token or use whitespace-tolerant regex replacement (for example `/\/\*__FINANCE_DATA__\*\/\s*\{\}/`) and add safe defaults before render.

3. **File/Directory:** `extensions/fin-core/dashboard/finance-dashboard.html`
   **Line:** 90
   **Severity:** high
   **Category:** Diff
   **Description:** Dynamic values are interpolated into `innerHTML` (`entry.id`, `entry.exchange`, plugin ids), enabling DOM XSS if identifiers contain HTML/script payloads.
   **Suggested fix:** Build DOM via `createElement` + `textContent` (or robust escaping) and avoid string-based `innerHTML` for untrusted content.

## Medium

1. **File/Directory:** `extensions/**`, `tsconfig.json`
   **Line:** N/A (structural)
   **Severity:** medium
   **Category:** Holistic
   **Description:** Plugin SDK namespace usage is split between `openclaw/plugin-sdk` and `openfinclaw/plugin-sdk`, creating an unclear compatibility contract.
   **Suggested fix:** Define one canonical SDK namespace and enforce through lint/CI; keep a single compatibility shim only where necessary.

2. **File/Directory:** `src/memory/qmd-manager.ts`, `src/commands/doctor-config-flow.ts`, `src/agents/tools/web-search.ts`, `src/telegram/bot-handlers.ts`, `src/config/io.ts`
   **Line:** N/A (structural)
   **Severity:** medium
   **Category:** Holistic
   **Description:** Several core files are very large (~1.3k-1.9k LOC), increasing maintenance and review burden versus project guidance.
   **Suggested fix:** Split by responsibility, keep thin public facades, and add module-level tests for extracted units.

3. **File/Directory:** `src/gateway/server.impl.ts`
   **Line:** N/A (structural)
   **Severity:** medium
   **Category:** Holistic
   **Description:** Gateway startup logic is highly coupled in one file (~800 LOC, many imports) spanning bootstrap, migration, plugin loading, and transport wiring.
   **Suggested fix:** Refactor into staged startup components (auth/bootstrap/plugins/transports/sidecars) with a small orchestrator.

4. **File/Directory:** `extensions/fin-core/index.ts`
   **Line:** 358
   **Severity:** medium
   **Category:** Diff
   **Description:** Win-rate computation pairs `buys[i]` with `sells[i]` from descending-order lists; open/unmatched fills and quantity differences can mispair trades and skew results.
   **Suggested fix:** Sort ascending by execution time and apply FIFO, quantity-aware matching per `(accountId, symbol)`.

5. **File/Directory:** `extensions/fin-monitoring/index.ts`
   **Line:** 115
   **Severity:** medium
   **Category:** Diff
   **Description:** Alert evaluation always calls `getTicker(symbol, "crypto")`, so non-crypto symbols may resolve incorrectly or fail.
   **Suggested fix:** Resolve/store market type at alert creation and pass the correct market to `getTicker`.

6. **File/Directory:** `extensions/fin-paper-trading/src/paper-engine.test.ts`
   **Line:** 132
   **Severity:** medium
   **Category:** Diff
   **Description:** New market-hours/price-limit tests are weak/non-deterministic (accepting multiple outcomes or only generic rejection), allowing regressions to pass.
   **Suggested fix:** Freeze time (`vi.setSystemTime`) and assert specific status/reason outputs for open/closed sessions and limit violations.

## Low

1. **File/Directory:** `docs/ja-JP/AGENTS.md`, `docs/zh-CN/AGENTS.md`, `docs/reference/templates/AGENTS.md`, `docs/zh-CN/reference/templates/AGENTS.md`
   **Line:** N/A (structural)
   **Severity:** low
   **Category:** Holistic
   **Description:** These `AGENTS.md` paths do not have companion `CLAUDE.md` symlinks, which conflicts with repo policy expectations.
   **Suggested fix:** Add `CLAUDE.md -> AGENTS.md` symlinks for live instruction directories; for template docs, consider renaming to avoid policy tooling confusion.

2. **File/Directory:** `extensions/fin-core/index.test.ts`
   **Line:** 685
   **Severity:** low
   **Category:** Diff
   **Description:** Test asserts removal of `/*__FINANCE_DATA__*/{}` (no space), not the actual template token, so it does not validate real data injection behavior.
   **Suggested fix:** Assert against the exact token or validate injected JSON/rendered behavior directly.

## Summary

- **Total issues:** 12
- **By severity:** critical 1, high 3, medium 6, low 2
- **Agents that ran:** Diff Review (Agent 1), Holistic Review (Agent 2)
- **Overall assessment:** The recent diff contains at least one high-risk runtime bug and one high-risk XSS vector; the broader repo has documentation/command-surface inconsistencies and architecture hotspots that raise maintenance risk.
